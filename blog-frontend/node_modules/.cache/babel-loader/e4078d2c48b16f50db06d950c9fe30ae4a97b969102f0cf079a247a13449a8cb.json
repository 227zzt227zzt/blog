{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createTextVNode as _createTextVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"profile-container\"\n};\nconst _hoisted_2 = {\n  class: \"profile-card\"\n};\nconst _hoisted_3 = {\n  class: \"avatar-section\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_User = _resolveComponent(\"User\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_avatar = _resolveComponent(\"el-avatar\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_upload = _resolveComponent(\"el-upload\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_cache[6] || (_cache[6] = _createElementVNode(\"div\", {\n    class: \"header\"\n  }, [_createElementVNode(\"div\", {\n    class: \"logo\"\n  }, [_createElementVNode(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 24 24\",\n    fill: \"currentColor\"\n  }, [_createElementVNode(\"path\", {\n    d: \"M19 22H5a3 3 0 0 1-3-3V3a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v12h4v4a3 3 0 0 1-3 3zm-1-5v2a1 1 0 0 0 2 0v-2h-2zM6 7v2h8V7H6zm0 4v2h8v-2H6zm0 4v2h5v-2H6z\"\n  })]), _createElementVNode(\"h1\", null, \"个人中心\")])], -1 /* HOISTED */)), _createVNode(_component_el_form, {\n    ref: \"profileForm\",\n    model: $setup.form,\n    rules: $setup.rules,\n    \"label-width\": \"100px\",\n    class: \"profile-form\"\n  }, {\n    default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_avatar, {\n      size: 100,\n      src: $setup.form.avatar || 'https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png',\n      onError: () => true\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n        default: _withCtx(() => [_createVNode(_component_User)]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"src\"]), _createVNode(_component_el_upload, {\n      class: \"avatar-uploader\",\n      \"show-file-list\": false,\n      \"before-upload\": $setup.beforeAvatarUpload,\n      \"http-request\": $setup.handleAvatarUpload,\n      accept: \"image/*\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_button, {\n        type: \"primary\",\n        size: \"small\"\n      }, {\n        default: _withCtx(() => _cache[4] || (_cache[4] = [_createTextVNode(\"更换头像\")])),\n        _: 1 /* STABLE */,\n        __: [4]\n      })]),\n      _: 1 /* STABLE */\n    })]), _createVNode(_component_el_form_item, {\n      label: \"用户名\",\n      prop: \"username\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: $setup.form.username,\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.form.username = $event)\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"邮箱\",\n      prop: \"email\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: $setup.form.email,\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.form.email = $event)\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"昵称\",\n      prop: \"nickname\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: $setup.form.nickname,\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.form.nickname = $event)\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"个人简介\",\n      prop: \"bio\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: $setup.form.bio,\n        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $setup.form.bio = $event),\n        type: \"textarea\",\n        rows: 4,\n        placeholder: \"介绍一下自己吧...\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, null, {\n      default: _withCtx(() => [_createVNode(_component_el_button, {\n        type: \"primary\",\n        onClick: $setup.handleSubmit,\n        loading: $setup.loading\n      }, {\n        default: _withCtx(() => _cache[5] || (_cache[5] = [_createTextVNode(\" 保存修改 \")])),\n        _: 1 /* STABLE */,\n        __: [5]\n      }, 8 /* PROPS */, [\"loading\"])]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"model\"])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","xmlns","viewBox","fill","d","_createVNode","_component_el_form","ref","model","$setup","form","rules","_hoisted_3","_component_el_avatar","size","src","avatar","onError","_component_el_icon","_component_User","_component_el_upload","beforeAvatarUpload","handleAvatarUpload","accept","_component_el_button","type","_cache","_component_el_form_item","label","prop","_component_el_input","username","$event","email","nickname","bio","rows","placeholder","onClick","handleSubmit","loading"],"sources":["C:\\Users\\52291\\Desktop\\test\\blog\\blog\\blog-frontend\\src\\views\\ProfileView.vue"],"sourcesContent":["<template>\r\n  <div class=\"profile-container\">\r\n    <div class=\"profile-card\">\r\n      <div class=\"header\">\r\n        <div class=\"logo\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n            <path d=\"M19 22H5a3 3 0 0 1-3-3V3a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v12h4v4a3 3 0 0 1-3 3zm-1-5v2a1 1 0 0 0 2 0v-2h-2zM6 7v2h8V7H6zm0 4v2h8v-2H6zm0 4v2h5v-2H6z\"/>\r\n          </svg>\r\n          <h1>个人中心</h1>\r\n        </div>\r\n      </div>\r\n\r\n      <el-form \r\n        ref=\"profileForm\" \r\n        :model=\"form\" \r\n        :rules=\"rules\" \r\n        label-width=\"100px\"\r\n        class=\"profile-form\"\r\n      >\r\n        <div class=\"avatar-section\">\r\n          <el-avatar \r\n            :size=\"100\" \r\n            :src=\"form.avatar || 'https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png'\"\r\n            @error=\"() => true\"\r\n          >\r\n            <el-icon><User /></el-icon>\r\n          </el-avatar>\r\n          <el-upload\r\n            class=\"avatar-uploader\"\r\n            :show-file-list=\"false\"\r\n            :before-upload=\"beforeAvatarUpload\"\r\n            :http-request=\"handleAvatarUpload\"\r\n            accept=\"image/*\"\r\n          >\r\n            <el-button type=\"primary\" size=\"small\">更换头像</el-button>\r\n          </el-upload>\r\n        </div>\r\n\r\n        <el-form-item label=\"用户名\" prop=\"username\">\r\n          <el-input v-model=\"form.username\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"邮箱\" prop=\"email\">\r\n          <el-input v-model=\"form.email\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"昵称\" prop=\"nickname\">\r\n          <el-input v-model=\"form.nickname\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"个人简介\" prop=\"bio\">\r\n          <el-input \r\n            v-model=\"form.bio\" \r\n            type=\"textarea\" \r\n            :rows=\"4\"\r\n            placeholder=\"介绍一下自己吧...\"\r\n          />\r\n        </el-form-item>\r\n\r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"handleSubmit\" :loading=\"loading\">\r\n            保存修改\r\n          </el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { useUserStore } from '@/store/user'\r\nimport { ElMessage } from 'element-plus'\r\nimport { updateProfile,uploadAvatar } from '@/api/user'\r\nimport { useRouter } from 'vue-router'\r\n\r\nconst userStore = useUserStore()\r\nconst router = useRouter()\r\nconst loading = ref(false)\r\n\r\nconst form = ref({\r\n  id: '',\r\n  username: '',\r\n  email: '',\r\n  nickname: '',\r\n  bio: '',\r\n  avatar: ''\r\n})\r\n\r\nconst rules = {\r\n  username: [\r\n    { required: true, message: '请输入用户名', trigger: 'blur' },\r\n    { min: 3, max: 20, message: '长度在 3 到 20 个字符', trigger: 'blur' }\r\n  ],\r\n  email: [\r\n    { required: true, message: '请输入邮箱地址', trigger: 'blur' },\r\n    { type: 'email', message: '请输入正确的邮箱地址', trigger: 'blur' }\r\n  ],\r\n  nickname: [\r\n    { required: true, message: '请输入昵称', trigger: 'blur' }\r\n  ]\r\n}\r\n\r\nconst profileForm = ref(null)\r\n\r\nonMounted(async () => {\r\n  // 从 store 中获取用户信息\r\n  const userInfo = userStore.userInfo\r\n  if (userInfo) {\r\n    form.value = {\r\n      id: userInfo.id,\r\n      username: userInfo.username,\r\n      email: userInfo.email,\r\n      nickname: userInfo.nickname || '',\r\n      bio: userInfo.bio || '',\r\n      avatar: userInfo.avatar || ''\r\n    }\r\n  } else {\r\n    ElMessage.warning('请先登录')\r\n    router.push('/login')\r\n  }\r\n})\r\n\r\nconst beforeAvatarUpload = (file) => {\r\n  const isImage = file.type.startsWith('image/')\r\n  const isLt2M = file.size / 1024 / 1024 < 2\r\n\r\n  if (!isImage) {\r\n    ElMessage.error('上传头像图片只能是图片格式!')\r\n    return false\r\n  }\r\n  if (!isLt2M) {\r\n    ElMessage.error('上传头像图片大小不能超过 2MB!')\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nconst handleAvatarUpload = async (options) => {\r\n  try {\r\n    const file = options.file\r\n    const formData = new FormData()\r\n    formData.append('file', file)\r\n    const result = await uploadAvatar(formData)\r\n    if (result.code === 200) {\r\n      form.value.avatar = result.data\r\n      console.log('头像上传成功:', form.value.avatar)\r\n      ElMessage.success('头像上传成功')\r\n    } else {\r\n      ElMessage.error(result.message || '头像上传失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('头像上传失败:', error)\r\n    ElMessage.error(error.response?.data?.message || '头像上传失败')\r\n  }\r\n}\r\n\r\nconst handleSubmit = async () => {\r\n  if (!profileForm.value) return\r\n  \r\n  try {\r\n    await profileForm.value.validate()\r\n    loading.value = true\r\n    \r\n    const result = await updateProfile(form.value)\r\n    if (result.success) {\r\n      ElMessage.success('个人信息更新成功')\r\n      // 更新 store 中的用户信息\r\n      userStore.userInfo = {\r\n        ...userStore.userInfo,\r\n        ...form.value\r\n      }\r\n    } else {\r\n      ElMessage.error(result.message || '更新失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('更新失败:', error)\r\n    ElMessage.error(error.response?.data?.message || '更新失败')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.profile-container {\r\n  max-width: 800px;\r\n  margin: 40px auto;\r\n  padding: 0 20px;\r\n}\r\n\r\n.profile-card {\r\n  background: white;\r\n  border-radius: 12px;\r\n  padding: 30px;\r\n  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.header {\r\n  text-align: center;\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.logo {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 12px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.logo svg {\r\n  width: 36px;\r\n  height: 36px;\r\n  fill: #6e8efb;\r\n}\r\n\r\n.logo h1 {\r\n  font-size: 28px;\r\n  color: #333;\r\n  font-weight: 600;\r\n}\r\n\r\n.profile-form {\r\n  max-width: 600px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.avatar-section {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 15px;\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.avatar-uploader {\r\n  text-align: center;\r\n}\r\n\r\n:deep(.el-form-item__label) {\r\n  font-weight: 500;\r\n}\r\n\r\n:deep(.el-input__wrapper) {\r\n  box-shadow: 0 0 0 1px #dcdfe6 inset;\r\n}\r\n\r\n:deep(.el-input__wrapper:hover) {\r\n  box-shadow: 0 0 0 1px #6e8efb inset;\r\n}\r\n\r\n:deep(.el-input__wrapper.is-focus) {\r\n  box-shadow: 0 0 0 1px #6e8efb inset;\r\n}\r\n\r\n:deep(.el-button--primary) {\r\n  background: #6e8efb;\r\n  border-color: #6e8efb;\r\n}\r\n\r\n:deep(.el-button--primary:hover) {\r\n  background: #5a7de0;\r\n  border-color: #5a7de0;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}