{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted } from 'vue';\nimport { useUserStore } from '@/store/user';\nimport { ElMessage } from 'element-plus';\nimport { updateProfile, uploadAvatar } from '@/api/user';\nimport { useRouter } from 'vue-router';\nexport default {\n  __name: 'ProfileView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const userStore = useUserStore();\n    const router = useRouter();\n    const loading = ref(false);\n    const form = ref({\n      id: '',\n      username: '',\n      email: '',\n      nickname: '',\n      bio: '',\n      avatar: ''\n    });\n    const rules = {\n      username: [{\n        required: true,\n        message: '请输入用户名',\n        trigger: 'blur'\n      }, {\n        min: 3,\n        max: 20,\n        message: '长度在 3 到 20 个字符',\n        trigger: 'blur'\n      }],\n      email: [{\n        required: true,\n        message: '请输入邮箱地址',\n        trigger: 'blur'\n      }, {\n        type: 'email',\n        message: '请输入正确的邮箱地址',\n        trigger: 'blur'\n      }],\n      nickname: [{\n        required: true,\n        message: '请输入昵称',\n        trigger: 'blur'\n      }]\n    };\n    const profileForm = ref(null);\n    onMounted(async () => {\n      // 从 store 中获取用户信息\n      const userInfo = userStore.userInfo;\n      if (userInfo) {\n        form.value = {\n          id: userInfo.id,\n          username: userInfo.username,\n          email: userInfo.email,\n          nickname: userInfo.nickname || '',\n          bio: userInfo.bio || '',\n          avatar: userInfo.avatar || ''\n        };\n      } else {\n        ElMessage.warning('请先登录');\n        router.push('/login');\n      }\n    });\n    const beforeAvatarUpload = file => {\n      const isImage = file.type.startsWith('image/');\n      const isLt2M = file.size / 1024 / 1024 < 2;\n      if (!isImage) {\n        ElMessage.error('上传头像图片只能是图片格式!');\n        return false;\n      }\n      if (!isLt2M) {\n        ElMessage.error('上传头像图片大小不能超过 2MB!');\n        return false;\n      }\n      return true;\n    };\n    const handleAvatarUpload = async options => {\n      try {\n        const file = options.file;\n        const formData = new FormData();\n        formData.append('file', file);\n        const result = await uploadAvatar(formData);\n        if (result.code === 200) {\n          form.value.avatar = result.data;\n          console.log('头像上传成功:', form.value.avatar);\n          ElMessage.success('头像上传成功');\n        } else {\n          ElMessage.error(result.message || '头像上传失败');\n        }\n      } catch (error) {\n        console.error('头像上传失败:', error);\n        ElMessage.error(error.response?.data?.message || '头像上传失败');\n      }\n    };\n    const handleSubmit = async () => {\n      if (!profileForm.value) return;\n      try {\n        await profileForm.value.validate();\n        loading.value = true;\n        const result = await updateProfile(form.value);\n        if (result.success) {\n          ElMessage.success('个人信息更新成功');\n          // 更新 store 中的用户信息\n          userStore.userInfo = {\n            ...userStore.userInfo,\n            ...form.value\n          };\n        } else {\n          ElMessage.error(result.message || '更新失败');\n        }\n      } catch (error) {\n        console.error('更新失败:', error);\n        ElMessage.error(error.response?.data?.message || '更新失败');\n      } finally {\n        loading.value = false;\n      }\n    };\n    const __returned__ = {\n      userStore,\n      router,\n      loading,\n      form,\n      rules,\n      profileForm,\n      beforeAvatarUpload,\n      handleAvatarUpload,\n      handleSubmit,\n      ref,\n      onMounted,\n      get useUserStore() {\n        return useUserStore;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get updateProfile() {\n        return updateProfile;\n      },\n      get uploadAvatar() {\n        return uploadAvatar;\n      },\n      get useRouter() {\n        return useRouter;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","useUserStore","ElMessage","updateProfile","uploadAvatar","useRouter","userStore","router","loading","form","id","username","email","nickname","bio","avatar","rules","required","message","trigger","min","max","type","profileForm","userInfo","value","warning","push","beforeAvatarUpload","file","isImage","startsWith","isLt2M","size","error","handleAvatarUpload","options","formData","FormData","append","result","code","data","console","log","success","response","handleSubmit","validate"],"sources":["C:/Users/52291/Desktop/test/blog/blog/blog-frontend/src/views/ProfileView.vue"],"sourcesContent":["<template>\r\n  <div class=\"profile-container\">\r\n    <div class=\"profile-card\">\r\n      <div class=\"header\">\r\n        <div class=\"logo\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n            <path d=\"M19 22H5a3 3 0 0 1-3-3V3a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v12h4v4a3 3 0 0 1-3 3zm-1-5v2a1 1 0 0 0 2 0v-2h-2zM6 7v2h8V7H6zm0 4v2h8v-2H6zm0 4v2h5v-2H6z\"/>\r\n          </svg>\r\n          <h1>个人中心</h1>\r\n        </div>\r\n      </div>\r\n\r\n      <el-form \r\n        ref=\"profileForm\" \r\n        :model=\"form\" \r\n        :rules=\"rules\" \r\n        label-width=\"100px\"\r\n        class=\"profile-form\"\r\n      >\r\n        <div class=\"avatar-section\">\r\n          <el-avatar \r\n            :size=\"100\" \r\n            :src=\"form.avatar || 'https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png'\"\r\n            @error=\"() => true\"\r\n          >\r\n            <el-icon><User /></el-icon>\r\n          </el-avatar>\r\n          <el-upload\r\n            class=\"avatar-uploader\"\r\n            :show-file-list=\"false\"\r\n            :before-upload=\"beforeAvatarUpload\"\r\n            :http-request=\"handleAvatarUpload\"\r\n            accept=\"image/*\"\r\n          >\r\n            <el-button type=\"primary\" size=\"small\">更换头像</el-button>\r\n          </el-upload>\r\n        </div>\r\n\r\n        <el-form-item label=\"用户名\" prop=\"username\">\r\n          <el-input v-model=\"form.username\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"邮箱\" prop=\"email\">\r\n          <el-input v-model=\"form.email\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"昵称\" prop=\"nickname\">\r\n          <el-input v-model=\"form.nickname\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"个人简介\" prop=\"bio\">\r\n          <el-input \r\n            v-model=\"form.bio\" \r\n            type=\"textarea\" \r\n            :rows=\"4\"\r\n            placeholder=\"介绍一下自己吧...\"\r\n          />\r\n        </el-form-item>\r\n\r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"handleSubmit\" :loading=\"loading\">\r\n            保存修改\r\n          </el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { useUserStore } from '@/store/user'\r\nimport { ElMessage } from 'element-plus'\r\nimport { updateProfile,uploadAvatar } from '@/api/user'\r\nimport { useRouter } from 'vue-router'\r\n\r\nconst userStore = useUserStore()\r\nconst router = useRouter()\r\nconst loading = ref(false)\r\n\r\nconst form = ref({\r\n  id: '',\r\n  username: '',\r\n  email: '',\r\n  nickname: '',\r\n  bio: '',\r\n  avatar: ''\r\n})\r\n\r\nconst rules = {\r\n  username: [\r\n    { required: true, message: '请输入用户名', trigger: 'blur' },\r\n    { min: 3, max: 20, message: '长度在 3 到 20 个字符', trigger: 'blur' }\r\n  ],\r\n  email: [\r\n    { required: true, message: '请输入邮箱地址', trigger: 'blur' },\r\n    { type: 'email', message: '请输入正确的邮箱地址', trigger: 'blur' }\r\n  ],\r\n  nickname: [\r\n    { required: true, message: '请输入昵称', trigger: 'blur' }\r\n  ]\r\n}\r\n\r\nconst profileForm = ref(null)\r\n\r\nonMounted(async () => {\r\n  // 从 store 中获取用户信息\r\n  const userInfo = userStore.userInfo\r\n  if (userInfo) {\r\n    form.value = {\r\n      id: userInfo.id,\r\n      username: userInfo.username,\r\n      email: userInfo.email,\r\n      nickname: userInfo.nickname || '',\r\n      bio: userInfo.bio || '',\r\n      avatar: userInfo.avatar || ''\r\n    }\r\n  } else {\r\n    ElMessage.warning('请先登录')\r\n    router.push('/login')\r\n  }\r\n})\r\n\r\nconst beforeAvatarUpload = (file) => {\r\n  const isImage = file.type.startsWith('image/')\r\n  const isLt2M = file.size / 1024 / 1024 < 2\r\n\r\n  if (!isImage) {\r\n    ElMessage.error('上传头像图片只能是图片格式!')\r\n    return false\r\n  }\r\n  if (!isLt2M) {\r\n    ElMessage.error('上传头像图片大小不能超过 2MB!')\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nconst handleAvatarUpload = async (options) => {\r\n  try {\r\n    const file = options.file\r\n    const formData = new FormData()\r\n    formData.append('file', file)\r\n    const result = await uploadAvatar(formData)\r\n    if (result.code === 200) {\r\n      form.value.avatar = result.data\r\n      console.log('头像上传成功:', form.value.avatar)\r\n      ElMessage.success('头像上传成功')\r\n    } else {\r\n      ElMessage.error(result.message || '头像上传失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('头像上传失败:', error)\r\n    ElMessage.error(error.response?.data?.message || '头像上传失败')\r\n  }\r\n}\r\n\r\nconst handleSubmit = async () => {\r\n  if (!profileForm.value) return\r\n  \r\n  try {\r\n    await profileForm.value.validate()\r\n    loading.value = true\r\n    \r\n    const result = await updateProfile(form.value)\r\n    if (result.success) {\r\n      ElMessage.success('个人信息更新成功')\r\n      // 更新 store 中的用户信息\r\n      userStore.userInfo = {\r\n        ...userStore.userInfo,\r\n        ...form.value\r\n      }\r\n    } else {\r\n      ElMessage.error(result.message || '更新失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('更新失败:', error)\r\n    ElMessage.error(error.response?.data?.message || '更新失败')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.profile-container {\r\n  max-width: 800px;\r\n  margin: 40px auto;\r\n  padding: 0 20px;\r\n}\r\n\r\n.profile-card {\r\n  background: white;\r\n  border-radius: 12px;\r\n  padding: 30px;\r\n  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.header {\r\n  text-align: center;\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.logo {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 12px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.logo svg {\r\n  width: 36px;\r\n  height: 36px;\r\n  fill: #6e8efb;\r\n}\r\n\r\n.logo h1 {\r\n  font-size: 28px;\r\n  color: #333;\r\n  font-weight: 600;\r\n}\r\n\r\n.profile-form {\r\n  max-width: 600px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.avatar-section {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 15px;\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.avatar-uploader {\r\n  text-align: center;\r\n}\r\n\r\n:deep(.el-form-item__label) {\r\n  font-weight: 500;\r\n}\r\n\r\n:deep(.el-input__wrapper) {\r\n  box-shadow: 0 0 0 1px #dcdfe6 inset;\r\n}\r\n\r\n:deep(.el-input__wrapper:hover) {\r\n  box-shadow: 0 0 0 1px #6e8efb inset;\r\n}\r\n\r\n:deep(.el-input__wrapper.is-focus) {\r\n  box-shadow: 0 0 0 1px #6e8efb inset;\r\n}\r\n\r\n:deep(.el-button--primary) {\r\n  background: #6e8efb;\r\n  border-color: #6e8efb;\r\n}\r\n\r\n:deep(.el-button--primary:hover) {\r\n  background: #5a7de0;\r\n  border-color: #5a7de0;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}