{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { uploadArticleCover, createArticle } from '@/api/article';\nimport { ElMessage } from 'element-plus';\nexport default {\n  __name: 'ArticleCreateView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const form = ref({\n      title: '',\n      summary: '',\n      content: '',\n      coverImage: '',\n      categoryId: ''\n    });\n    const beforeUpload = file => {\n      if (!file.type.startsWith('image/')) {\n        ElMessage.error('只能上传图片');\n        return false;\n      }\n      if (file.size > 5 * 1024 * 1024) {\n        ElMessage.error('图片大小不能超过5MB');\n        return false;\n      }\n      return true;\n    };\n    const coverImage1 = ref('');\n    const handleCoverUpload = async options => {\n      try {\n        const formData = new FormData();\n        formData.append('file', options.file);\n        const res = await uploadArticleCover(formData);\n        if (res.success) {\n          coverImage1.value = res.data;\n          form.value.coverImage = 'http://localhost:8082/' + coverImage1.value;\n          console.log('封面上传成功:', form.value.coverImage);\n          ElMessage.success('封面上传成功');\n        } else {\n          ElMessage.error(res.message || '封面上传失败');\n        }\n      } catch (error) {\n        console.error('封面上传失败:', error);\n        ElMessage.error(error.response?.data?.message || '封面上传失败');\n      }\n    };\n    const handleSubmit = async () => {\n      if (!form.value.title) {\n        ElMessage.warning('请输入文章标题');\n        return;\n      }\n      if (!form.value.summary) {\n        ElMessage.warning('请输入文章摘要');\n        return;\n      }\n      if (!form.value.content) {\n        ElMessage.warning('请输入文章内容');\n        return;\n      }\n      if (!form.value.coverImage) {\n        ElMessage.warning('请上传封面图片');\n        return;\n      }\n      // categoryId 可选，如有分类可校验\n      // if (!form.value.categoryId) {\n      //   ElMessage.warning('请选择分类')\n      //   return\n      // }\n      console.log('提交的文章数据:', form.value);\n      try {\n        const res = await createArticle({\n          title: form.value.title,\n          summary: form.value.summary,\n          content: form.value.content,\n          categoryId: form.value.categoryId || null,\n          coverImage: coverImage1.value || null,\n          status: '1' // 或 1，视后端支持\n        });\n        if (res.success) {\n          ElMessage.success('文章发布成功');\n          router.push('/articles');\n        } else {\n          ElMessage.error(res.message || '发布失败');\n        }\n      } catch (error) {\n        console.error('发布文章失败:', error);\n        ElMessage.error('发布失败');\n      }\n    };\n    const __returned__ = {\n      router,\n      form,\n      beforeUpload,\n      coverImage1,\n      handleCoverUpload,\n      handleSubmit,\n      ref,\n      get useRouter() {\n        return useRouter;\n      },\n      get uploadArticleCover() {\n        return uploadArticleCover;\n      },\n      get createArticle() {\n        return createArticle;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","useRouter","uploadArticleCover","createArticle","ElMessage","router","form","title","summary","content","coverImage","categoryId","beforeUpload","file","type","startsWith","error","size","coverImage1","handleCoverUpload","options","formData","FormData","append","res","success","value","data","console","log","message","response","handleSubmit","warning","status","push"],"sources":["C:/Users/52291/Desktop/test/blog/blog/blog-frontend/src/views/ArticleCreateView.vue"],"sourcesContent":["<template>\r\n    <div class=\"create-article-container\">\r\n      <el-form :model=\"form\" label-width=\"80px\">\r\n        <el-form-item label=\"标题\">\r\n          <el-input v-model=\"form.title\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"摘要\">\r\n          <el-input v-model=\"form.summary\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"内容\">\r\n          <el-input type=\"textarea\" v-model=\"form.content\" :rows=\"10\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"封面\">\r\n          <el-upload\r\n            :show-file-list=\"false\"\r\n            :before-upload=\"beforeUpload\"\r\n            :http-request=\"handleCoverUpload\"\r\n            accept=\"image/*\"\r\n          >\r\n            <el-button>上传封面</el-button>\r\n          </el-upload>\r\n          <img v-if=\"form.coverImage\" :src=\"form.coverImage\" style=\"max-width: 200px; margin-left: 20px;\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"分类\">\r\n          <el-input v-model=\"form.categoryId\" placeholder=\"请输入分类ID（如无可留空）\" />\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"handleSubmit\">发布</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n  </template>\r\n  \r\n  <script setup>\r\n  import { ref } from 'vue'\r\n  import { useRouter } from 'vue-router'\r\n  import { uploadArticleCover, createArticle } from '@/api/article'\r\n  import { ElMessage } from 'element-plus'\r\n\r\n  const router = useRouter()\r\n  const form = ref({\r\n    title: '',\r\n    summary: '',\r\n    content: '',\r\n    coverImage: '',\r\n    categoryId: '',\r\n  })\r\n  const beforeUpload = (file) => {\r\n    if (!file.type.startsWith('image/')) {\r\n      ElMessage.error('只能上传图片')\r\n      return false\r\n    }\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      ElMessage.error('图片大小不能超过5MB')\r\n      return false\r\n    }\r\n    return true\r\n  }\r\n  const coverImage1 = ref('')\r\n  const handleCoverUpload = async (options) => {\r\n    try {\r\n      const formData = new FormData()\r\n      formData.append('file', options.file)\r\n      const res = await uploadArticleCover(formData)\r\n      if (res.success) {\r\n        coverImage1.value =res.data\r\n        form.value.coverImage ='http://localhost:8082/'+ coverImage1.value\r\n        console.log('封面上传成功:', form.value.coverImage)\r\n        ElMessage.success('封面上传成功')\r\n      } else {\r\n        ElMessage.error(res.message || '封面上传失败')\r\n      }\r\n    } catch (error) {\r\n      console.error('封面上传失败:', error)\r\n      ElMessage.error(error.response?.data?.message || '封面上传失败')\r\n    }\r\n  }\r\n  \r\n  const handleSubmit = async () => {\r\n    if (!form.value.title) {\r\n      ElMessage.warning('请输入文章标题')\r\n      return\r\n    }\r\n    if (!form.value.summary) {\r\n      ElMessage.warning('请输入文章摘要')\r\n      return\r\n    }\r\n    if (!form.value.content) {\r\n      ElMessage.warning('请输入文章内容')\r\n      return\r\n    }\r\n    if (!form.value.coverImage) {\r\n      ElMessage.warning('请上传封面图片')\r\n      return\r\n    }\r\n    // categoryId 可选，如有分类可校验\r\n    // if (!form.value.categoryId) {\r\n    //   ElMessage.warning('请选择分类')\r\n    //   return\r\n    // }\r\n    console.log('提交的文章数据:', form.value)\r\n    try {\r\n      const res = await createArticle({\r\n        title: form.value.title,\r\n        summary: form.value.summary,\r\n        content: form.value.content,\r\n        categoryId: form.value.categoryId || null,\r\n        coverImage: coverImage1.value || null,\r\n        status: '1', // 或 1，视后端支持\r\n      })\r\n      if (res.success) {\r\n        ElMessage.success('文章发布成功')\r\n        router.push('/articles')\r\n      } else {\r\n        ElMessage.error(res.message || '发布失败')\r\n      }\r\n    } catch (error) {\r\n      console.error('发布文章失败:', error)\r\n      ElMessage.error('发布失败')\r\n    }\r\n  }\r\n  </script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}