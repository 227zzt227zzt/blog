{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted } from 'vue';\nimport { useRouter, useRoute } from 'vue-router';\nimport { uploadArticleCover, getArticleById, updateArticle } from '@/api/article';\nimport { ElMessage } from 'element-plus';\nexport default {\n  __name: 'ArticleEditView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const route = useRoute();\n    const form = ref({\n      id: null,\n      title: '',\n      summary: '',\n      content: '',\n      coverImage: ''\n    });\n    const loadArticle = async () => {\n      try {\n        const res = await getArticleById(route.params.id);\n        if (res.success) {\n          const article = res.data;\n          form.value = {\n            id: article.id,\n            title: article.title,\n            summary: article.summary,\n            content: article.content,\n            coverImage: article.coverImage\n          };\n        } else {\n          ElMessage.error(res.message || '获取文章失败');\n          router.push('/articles');\n        }\n      } catch (error) {\n        console.error('获取文章失败:', error);\n        ElMessage.error('获取文章失败');\n        router.push('/articles');\n      }\n    };\n    const beforeUpload = file => {\n      if (!file.type.startsWith('image/')) {\n        ElMessage.error('只能上传图片');\n        return false;\n      }\n      return true;\n    };\n    const handleCoverUpload = async options => {\n      const formData = new FormData();\n      formData.append('file', options.file);\n      formData.append('articleId', form.value.id);\n      const res = await uploadArticleCover(formData);\n      if (res.success) {\n        form.value.coverImage = res.data;\n        ElMessage.success('封面上传成功');\n      } else {\n        ElMessage.error(res.message);\n      }\n    };\n    const handleSubmit = async () => {\n      if (!form.value.title) {\n        ElMessage.warning('请输入文章标题');\n        return;\n      }\n      if (!form.value.content) {\n        ElMessage.warning('请输入文章内容');\n        return;\n      }\n      try {\n        const res = await updateArticle(form.value.id, {\n          title: form.value.title,\n          summary: form.value.summary,\n          content: form.value.content,\n          coverImage: form.value.coverImage\n        });\n        if (res.success) {\n          ElMessage.success('文章更新成功');\n          router.push(`/article/${form.value.id}`);\n        } else {\n          ElMessage.error(res.message || '更新失败');\n        }\n      } catch (error) {\n        console.error('更新文章失败:', error);\n        ElMessage.error('更新失败');\n      }\n    };\n    const goBack = () => {\n      router.back();\n    };\n    onMounted(() => {\n      loadArticle();\n    });\n    const __returned__ = {\n      router,\n      route,\n      form,\n      loadArticle,\n      beforeUpload,\n      handleCoverUpload,\n      handleSubmit,\n      goBack,\n      ref,\n      onMounted,\n      get useRouter() {\n        return useRouter;\n      },\n      get useRoute() {\n        return useRoute;\n      },\n      get uploadArticleCover() {\n        return uploadArticleCover;\n      },\n      get getArticleById() {\n        return getArticleById;\n      },\n      get updateArticle() {\n        return updateArticle;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","useRouter","useRoute","uploadArticleCover","getArticleById","updateArticle","ElMessage","router","route","form","id","title","summary","content","coverImage","loadArticle","res","params","success","article","data","value","error","message","push","console","beforeUpload","file","type","startsWith","handleCoverUpload","options","formData","FormData","append","handleSubmit","warning","goBack","back"],"sources":["C:/Users/52291/Desktop/test/blog/blog/blog-frontend/src/views/ArticleEditView.vue"],"sourcesContent":["<template>\r\n  <div class=\"edit-article-container\">\r\n    <el-form :model=\"form\" label-width=\"80px\">\r\n      <el-form-item label=\"标题\">\r\n        <el-input v-model=\"form.title\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"摘要\">\r\n        <el-input v-model=\"form.summary\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"内容\">\r\n        <el-input type=\"textarea\" v-model=\"form.content\" :rows=\"10\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"封面\">\r\n        <el-upload\r\n          :show-file-list=\"false\"\r\n          :before-upload=\"beforeUpload\"\r\n          :http-request=\"handleCoverUpload\"\r\n          accept=\"image/*\"\r\n        >\r\n          <el-button>上传封面</el-button>\r\n        </el-upload>\r\n        <img v-if=\"form.coverImage\" :src=\"form.coverImage\" style=\"max-width: 200px; margin-left: 20px;\" />\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" @click=\"handleSubmit\">保存</el-button>\r\n        <el-button @click=\"goBack\">取消</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { useRouter, useRoute } from 'vue-router'\r\nimport { uploadArticleCover, getArticleById, updateArticle } from '@/api/article'\r\nimport { ElMessage } from 'element-plus'\r\n\r\nconst router = useRouter()\r\nconst route = useRoute()\r\nconst form = ref({\r\n  id: null,\r\n  title: '',\r\n  summary: '',\r\n  content: '',\r\n  coverImage: ''\r\n})\r\n\r\nconst loadArticle = async () => {\r\n  try {\r\n    const res = await getArticleById(route.params.id)\r\n    if (res.success) {\r\n      const article = res.data\r\n      form.value = {\r\n        id: article.id,\r\n        title: article.title,\r\n        summary: article.summary,\r\n        content: article.content,\r\n        coverImage: article.coverImage\r\n      }\r\n    } else {\r\n      ElMessage.error(res.message || '获取文章失败')\r\n      router.push('/articles')\r\n    }\r\n  } catch (error) {\r\n    console.error('获取文章失败:', error)\r\n    ElMessage.error('获取文章失败')\r\n    router.push('/articles')\r\n  }\r\n}\r\n\r\nconst beforeUpload = (file) => {\r\n  if (!file.type.startsWith('image/')) {\r\n    ElMessage.error('只能上传图片')\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nconst handleCoverUpload = async (options) => {\r\n  const formData = new FormData()\r\n  formData.append('file', options.file)\r\n  formData.append('articleId', form.value.id)\r\n  const res = await uploadArticleCover(formData)\r\n  if (res.success) {\r\n    form.value.coverImage = res.data\r\n    ElMessage.success('封面上传成功')\r\n  } else {\r\n    ElMessage.error(res.message)\r\n  }\r\n}\r\n\r\nconst handleSubmit = async () => {\r\n  if (!form.value.title) {\r\n    ElMessage.warning('请输入文章标题')\r\n    return\r\n  }\r\n  if (!form.value.content) {\r\n    ElMessage.warning('请输入文章内容')\r\n    return\r\n  }\r\n  \r\n  try {\r\n    const res = await updateArticle(form.value.id, {\r\n      title: form.value.title,\r\n      summary: form.value.summary,\r\n      content: form.value.content,\r\n      coverImage: form.value.coverImage\r\n    })\r\n    \r\n    if (res.success) {\r\n      ElMessage.success('文章更新成功')\r\n      router.push(`/article/${form.value.id}`)\r\n    } else {\r\n      ElMessage.error(res.message || '更新失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('更新文章失败:', error)\r\n    ElMessage.error('更新失败')\r\n  }\r\n}\r\n\r\nconst goBack = () => {\r\n  router.back()\r\n}\r\n\r\nonMounted(() => {\r\n  loadArticle()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.edit-article-container {\r\n  max-width: 800px;\r\n  margin: 40px auto;\r\n  padding: 20px;\r\n  background: white;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n:deep(.el-form-item__label) {\r\n  font-weight: 500;\r\n}\r\n\r\n:deep(.el-input__inner) {\r\n  border-radius: 4px;\r\n}\r\n\r\n:deep(.el-textarea__inner) {\r\n  border-radius: 4px;\r\n  font-family: monospace;\r\n}\r\n\r\n:deep(.el-button--primary) {\r\n  background: #6e8efb;\r\n  border-color: #6e8efb;\r\n}\r\n\r\n:deep(.el-button--primary:hover) {\r\n  background: #5a7de0;\r\n  border-color: #5a7de0;\r\n}\r\n</style>\r\n"],"mappings":";AAgCA,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAK;AACpC,SAASC,SAAS,EAAEC,QAAQ,QAAQ,YAAY;AAChD,SAASC,kBAAkB,EAAEC,cAAc,EAAEC,aAAa,QAAQ,eAAe;AACjF,SAASC,SAAS,QAAQ,cAAc;;;;;;;IAExC,MAAMC,MAAM,GAAGN,SAAS,CAAC,CAAC;IAC1B,MAAMO,KAAK,GAAGN,QAAQ,CAAC,CAAC;IACxB,MAAMO,IAAI,GAAGV,GAAG,CAAC;MACfW,EAAE,EAAE,IAAI;MACRC,KAAK,EAAE,EAAE;MACTC,OAAO,EAAE,EAAE;MACXC,OAAO,EAAE,EAAE;MACXC,UAAU,EAAE;IACd,CAAC,CAAC;IAEF,MAAMC,WAAW,GAAG,MAAAA,CAAA,KAAY;MAC9B,IAAI;QACF,MAAMC,GAAG,GAAG,MAAMZ,cAAc,CAACI,KAAK,CAACS,MAAM,CAACP,EAAE,CAAC;QACjD,IAAIM,GAAG,CAACE,OAAO,EAAE;UACf,MAAMC,OAAO,GAAGH,GAAG,CAACI,IAAI;UACxBX,IAAI,CAACY,KAAK,GAAG;YACXX,EAAE,EAAES,OAAO,CAACT,EAAE;YACdC,KAAK,EAAEQ,OAAO,CAACR,KAAK;YACpBC,OAAO,EAAEO,OAAO,CAACP,OAAO;YACxBC,OAAO,EAAEM,OAAO,CAACN,OAAO;YACxBC,UAAU,EAAEK,OAAO,CAACL;UACtB,CAAC;QACH,CAAC,MAAM;UACLR,SAAS,CAACgB,KAAK,CAACN,GAAG,CAACO,OAAO,IAAI,QAAQ,CAAC;UACxChB,MAAM,CAACiB,IAAI,CAAC,WAAW,CAAC;QAC1B;MACF,CAAC,CAAC,OAAOF,KAAK,EAAE;QACdG,OAAO,CAACH,KAAK,CAAC,SAAS,EAAEA,KAAK,CAAC;QAC/BhB,SAAS,CAACgB,KAAK,CAAC,QAAQ,CAAC;QACzBf,MAAM,CAACiB,IAAI,CAAC,WAAW,CAAC;MAC1B;IACF,CAAC;IAED,MAAME,YAAY,GAAIC,IAAI,IAAK;MAC7B,IAAI,CAACA,IAAI,CAACC,IAAI,CAACC,UAAU,CAAC,QAAQ,CAAC,EAAE;QACnCvB,SAAS,CAACgB,KAAK,CAAC,QAAQ,CAAC;QACzB,OAAO,KAAK;MACd;MACA,OAAO,IAAI;IACb,CAAC;IAED,MAAMQ,iBAAiB,GAAG,MAAOC,OAAO,IAAK;MAC3C,MAAMC,QAAQ,GAAG,IAAIC,QAAQ,CAAC,CAAC;MAC/BD,QAAQ,CAACE,MAAM,CAAC,MAAM,EAAEH,OAAO,CAACJ,IAAI,CAAC;MACrCK,QAAQ,CAACE,MAAM,CAAC,WAAW,EAAEzB,IAAI,CAACY,KAAK,CAACX,EAAE,CAAC;MAC3C,MAAMM,GAAG,GAAG,MAAMb,kBAAkB,CAAC6B,QAAQ,CAAC;MAC9C,IAAIhB,GAAG,CAACE,OAAO,EAAE;QACfT,IAAI,CAACY,KAAK,CAACP,UAAU,GAAGE,GAAG,CAACI,IAAI;QAChCd,SAAS,CAACY,OAAO,CAAC,QAAQ,CAAC;MAC7B,CAAC,MAAM;QACLZ,SAAS,CAACgB,KAAK,CAACN,GAAG,CAACO,OAAO,CAAC;MAC9B;IACF,CAAC;IAED,MAAMY,YAAY,GAAG,MAAAA,CAAA,KAAY;MAC/B,IAAI,CAAC1B,IAAI,CAACY,KAAK,CAACV,KAAK,EAAE;QACrBL,SAAS,CAAC8B,OAAO,CAAC,SAAS,CAAC;QAC5B;MACF;MACA,IAAI,CAAC3B,IAAI,CAACY,KAAK,CAACR,OAAO,EAAE;QACvBP,SAAS,CAAC8B,OAAO,CAAC,SAAS,CAAC;QAC5B;MACF;MAEA,IAAI;QACF,MAAMpB,GAAG,GAAG,MAAMX,aAAa,CAACI,IAAI,CAACY,KAAK,CAACX,EAAE,EAAE;UAC7CC,KAAK,EAAEF,IAAI,CAACY,KAAK,CAACV,KAAK;UACvBC,OAAO,EAAEH,IAAI,CAACY,KAAK,CAACT,OAAO;UAC3BC,OAAO,EAAEJ,IAAI,CAACY,KAAK,CAACR,OAAO;UAC3BC,UAAU,EAAEL,IAAI,CAACY,KAAK,CAACP;QACzB,CAAC,CAAC;QAEF,IAAIE,GAAG,CAACE,OAAO,EAAE;UACfZ,SAAS,CAACY,OAAO,CAAC,QAAQ,CAAC;UAC3BX,MAAM,CAACiB,IAAI,CAAC,YAAYf,IAAI,CAACY,KAAK,CAACX,EAAE,EAAE,CAAC;QAC1C,CAAC,MAAM;UACLJ,SAAS,CAACgB,KAAK,CAACN,GAAG,CAACO,OAAO,IAAI,MAAM,CAAC;QACxC;MACF,CAAC,CAAC,OAAOD,KAAK,EAAE;QACdG,OAAO,CAACH,KAAK,CAAC,SAAS,EAAEA,KAAK,CAAC;QAC/BhB,SAAS,CAACgB,KAAK,CAAC,MAAM,CAAC;MACzB;IACF,CAAC;IAED,MAAMe,MAAM,GAAGA,CAAA,KAAM;MACnB9B,MAAM,CAAC+B,IAAI,CAAC,CAAC;IACf,CAAC;IAEDtC,SAAS,CAAC,MAAM;MACde,WAAW,CAAC,CAAC;IACf,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}